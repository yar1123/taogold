/*
Copyright 2011, KISSY UI Library v1.20dev
MIT Licensed
build time: ${build.time}
*/
KISSY.add("menu/menu",function(h,f,g,d){var e;e=f.create(g.ModelControl,[f.Position,f.Align],{_bindMenuItem:function(b){var a=this;b.on("afterHighlightedChange",function(c){a.set("highlightedItem",c.newVal?b:null)});b.on("click",function(){a.fire("menuItemClick",{menuItem:this})})},_uiSetHighlightedItem:function(b,a){a&&a.prevVal&&a.prevVal.set("highlighted",false);b&&b.set("highlighted",true);this.get("view").set("highlightedItem",b);this.set("activeItem",b)},_handleBlur:function(){if(e.superclass._handleBlur.call(this)===
false)return false;this.set("highlightedItem",null)},_getNextEnabledHighlighted:function(b,a){var c=this.get("children");if(c.length==0)return null;if(!c[b].get("disabled"))return c[b];var i=b;for(b+=a;b!=i;){if(!c[b].get("disabled"))return c[b];b+=a;if(b==-1)b=c.length-1;else if(b==c.length)b=0}return null},_handleKeydown:function(b){if(e.superclass._handleKeydown.call(this,b)===false)return false;var a=this.get("highlightedItem");if(a&&a._handleKeydown)if(a._handleKeydown(b)===false)return false;
var c=this.get("children");if(c.length!==0)if(b.keyCode==38){if(a){a=h.indexOf(a,c);c=a==0?c.length-1:a-1;this.set("highlightedItem",this._getNextEnabledHighlighted(c,-1))}else this.set("highlightedItem",this._getNextEnabledHighlighted(c.length-1,-1));b.preventDefault();return false}else if(b.keyCode==40){if(a){a=h.indexOf(a,c);c=a==c.length-1?0:a+1;this.set("highlightedItem",this._getNextEnabledHighlighted(c,1))}else this.set("highlightedItem",this._getNextEnabledHighlighted(0,1));b.preventDefault();
return false}},bindUI:function(){var b=this;h.each(this.get("children"),function(a){b._bindMenuItem(a)});b.on("hide",function(){b.set("highlightedItem",null)})}},{ATTRS:{highlightedItem:{},activeItem:{view:true},focusable:{value:true,view:true}}});e.DefaultRender=d;return e},{requires:["uibase","component","./menurender"]});
KISSY.add("menu/menuitem",function(h,f,g,d){var e=f.create(g.ModelControl,{_handleMouseEnter:function(){if(e.superclass._handleMouseEnter.call(this)===false)return false;this.set("highlighted",true)},_handleMouseLeave:function(){if(e.superclass._handleMouseLeave.call(this)===false)return false;this.set("highlighted",false)}},{ATTRS:{content:{view:true},highlighted:{view:true,value:false}}});e.DefaultRender=d;return e},{requires:["uibase","component","./menuitemrender"]});
KISSY.add("menu/menuitemrender",function(h,f,g){return f.create(g.Render,{renderUI:function(){var d=this.get("el");d.html("<div class='"+this.get("prefixCls")+"menuitem-content'>");d.attr("role","menuitem");d.unselectable();d.attr("id")||d.attr("id",h.guid("ks-menuitem"))},_uiSetContent:function(d){var e=this.get("el").children("div");e.item(e.length-1).html(d)},_uiSetDisabled:function(d){var e=this.get("el");d?e.addClass(this.get("prefixCls")+"menuitem-disabled"):e.removeClass(this.get("prefixCls")+
"menuitem-disabled");e.attr("aria-disabled",!!d)},_uiSetHighlighted:function(d){d?this.get("el").addClass(this.get("prefixCls")+"menuitem-highlight"):this.get("el").removeClass(this.get("prefixCls")+"menuitem-highlight")},_handleMouseDown:function(){this.get("el").addClass(this.get("prefixCls")+"menuitem-active");this.get("el").attr("aria-pressed",true)},_handleMouseUp:function(){this.get("el").removeClass(this.get("prefixCls")+"menuitem-active");this.get("el").attr("aria-pressed",false)},_handleKeydown:function(){}},
{ATTRS:{elCls:{valueFn:function(){return this.get("prefixCls")+"menuitem"}},highlighted:{},prefixCls:{value:"goog-"},content:{}},HTML_PARSER:{content:function(d){return d.html()}}})},{requires:["uibase","component"]});
KISSY.add("menu/menurender",function(h,f,g,d){function e(b,a){var c=b.get("el");if(a){var i=a.get("view").get("el").attr("id");c.attr("aria-activedescendant",i)}else c.attr("aria-activedescendant","")}return g.create(d.Render,[g.Contentbox.Render,g.Position.Render,f.ie===6?g.Shim.Render:null],{renderUI:function(){var b=this.get("el");b.attr("role","menu");b.attr("aria-haspopup",true);b.attr("id")||b.attr("id",h.guid("ks-menu"))},_uiSetHighlightedItem:function(b){e(this,b)},_uiSetActiveItem:function(b){e(this,
b)},_uiSetDisabled:function(b){if(this.get("focusable"))this.get("el").attr("tabindex",b?-1:0)},_uiSetFocusable:function(b){if(!this.get("disabled"))if(!b){this.get("el").unselectable();this.get("el").attr("onmousedown","return false;")}},_handleKeydown:function(){}},{ATTRS:{highlightedItem:{},activeItem:{},elCls:{valueFn:function(){return this.get("prefixCls")+"menu "+this.get("prefixCls")+"menu-vertical"}},prefixCls:{value:"goog-"},focusable:{value:true}}})},{requires:["ua","uibase","component"]});
KISSY.add("menu/submenu",function(h,f,g,d,e){var b;b=f.create(d,{_handleMouseLeave:function(a){if(d.superclass._handleMouseLeave.call(this,a)===false)return false;var c=this.get("menu");c&&c.get("visible")&&(c.get("view").get("el").contains(a.relatedTarget)||c.get("view").get("el")[0]==a.relatedTarget[0])||this.set("highlighted",false)},_uiSetHighlighted:function(a){this.get("view").set("highlighted",a);a||this._hideSubMenu()},bindUI:function(){var a=this,c=a.get("parent"),i=this.get("menu");if(c){c.on("hide",
function(){a.get("menu")&&a.get("menu").hide()});i.on("menuItemClick",function(j){c.fire("menuItemClick",{menuItem:j.menuItem})});i.on("afterHighlightedItemChange afterActiveItemChange",function(j){c.set("activeItem",j.newVal)})}},_handleMouseEnter:function(){if(b.superclass._handleMouseEnter.call(this)===false)return false;this._showSubMenu()},_showSubMenu:function(){var a=this.get("menu");a.set("align",{node:this.get("view").get("el"),points:["tr","tl"]});a.render();this.get("view").get("el").attr("aria-haspopup",
a.get("view").get("el").attr("id"));a.show()},_hideSubMenu:function(){var a=this.get("menu");a&&a.hide()},_handleClickInternal:function(a){if(a&&a.type=="keydown")if((a=this.get("menu"))&&a.get("visible")&&a.get("highlightedItem"))return;b.superclass._handleClickInternal.call(this)},_handleKeydown:function(a){if(b.superclass._handleKeydown.call(this,a)===false)return false;var c=this.get("menu");if(a.keyCode==27)this._hideSubMenu();else{if(c&&c.get("visible"))if(c._handleKeydown(a)===false)return false;
if(a.keyCode==39&&(!c||!c.get("visible"))){this._showSubMenu();a=c.get("children");a[0]&&a[0].set("highlighted",true);return false}else if(a.keyCode==37&&c&&c.get("visible")){this._hideSubMenu();return false}}}},{ATTRS:{menu:{setter:function(a){a.set("focusable",false)}}}});b.DefaultRender=e;return b},{requires:["uibase","component","./menuitem","./submenurender"]});
KISSY.add("menu/submenurender",function(h,f,g){return f.create(g,{renderUI:function(){this.get("el").addClass(this.get("prefixCls")+"submenu");this.get("el").attr("aria-haspopup","true")},_uiSetContent:function(d){this.get("el").one("."+this.get("prefixCls")+"menuitem-content").html(d+h.substitute('<span class="{prefixCls}submenu-arrow">\u25ba</span>',{prefixCls:this.get("prefixCls")}))}},{})},{requires:["uibase","./menuitemrender"]});
KISSY.add("menu",function(h,f,g,d,e,b,a){f.Render=g;f.Item=d;f.Item.Render=e;f.SubMenu=b;b.Render=a;return f},{requires:["menu/menu","menu/menurender","menu/menuitem","menu/menuitemrender","menu/submenu","menu/submenurender"]});
