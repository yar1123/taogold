/*
Copyright 2011, KISSY UI Library v1.20dev
MIT Licensed
build time: ${build.time}
*/
KISSY.add("event/base",function(n,d,l,i){function m(a,b,j){if((j=n.trim(j))&&j.indexOf(v)>0){var q=n.makeArray(arguments);n.each(j.split(v),function(o){var h=n.clone(q);h.splice(0,3,b,o);p[a].apply(p,h)});return true}return i}function c(a){return a&&a.nodeType!==3&&a.nodeType!==8}var k=document,e=k.addEventListener?function(a,b,j,q){a.addEventListener&&a.addEventListener(b,j,!!q)}:function(a,b,j){a.attachEvent&&a.attachEvent("on"+b,j)},g=k.removeEventListener?function(a,b,j,q){a.removeEventListener&&
a.removeEventListener(b,j,!!q)}:function(a,b,j){a.detachEvent&&a.detachEvent("on"+b,j)},v=" ",t="",u="trigger-none-"+n.now(),f="ksEventTargetId"+n.now(),p={_data:function(){var a=n.makeArray(arguments);a.splice(1,0,f);return d.data.apply(d,a)},_removeData:function(){var a=n.makeArray(arguments);a.splice(1,0,f);return d.removeData.apply(d,a)},special:{},add:function(a,b,j,q,o){if(m("add",a,b,j,q,o))return a;d.query(a).each(function(h){var r=!h.isCustomEventTarget,s,y,w;if(!(!h||!b||!n.isFunction(j)||
r&&!c(h))){(s=p._data(h))||p._data(h,s={});y=s.events=s.events||{};w=s.handler;if(!w){w=s.handler=function(x,z){if(!(x&&x.type==t)){var C=w.target;if(!x||!x.fixed)x=new l(C,x);n.isPlainObject(z)&&n.mix(x,z);return p._handle(C,x)}};w.target=h}var A=y[b];s=p.special[b]||{};if(!A){A=y[b]=[];if((!s.setup||s.setup.call(h)===false)&&r)e(h,b,w)}r={fn:j,scope:q||h,data:o};s.add&&s.add.call(h,r);A.push(r);h=null}});return a},__getListeners:function(a,b){return(p.__getEvents(a)||{})[b]||[]},__getEvents:function(a){return(a=
p._data(a))&&a.events},remove:function(a,b,j,q,o){if(m("remove",a,b,j,q))return a;d.query(a).each(function(h){var r=p._data(h),s=r&&r.events,y,w,A,x,z,C=!h.isCustomEventTarget,E=C&&p.special[b]||{};if(!(!h||!C&&!c(h)||!s))if(b===i)for(b in s)p.remove(h,b);else{q=q||h;if(y=s[b]){w=y.length;if(n.isFunction(j)&&w){x=A=0;for(z=[];A<w;++A){var F=false,B=y[A];if(j!==B.fn||q!==B.scope){z[x++]=B;F=true}else if(o!==D){var D=B.data;if(!o&&D||D&&!o){z[x++]=B;F=true}else if(o&&D)if(!o.equals||!D.equals)n.error("no equals in data");
else if(!D.equals(o)){z[x++]=B;F=true}}!F&&E.remove&&E.remove.call(h,B)}s[b]=z;w=z.length}if(j===i||w===0){if(C)if(!E.tearDown||E.tearDown.call(h)===false)g(h,b,r.handler);delete s[b]}}if(n.isEmptyObject(s)){r.handler.target=null;delete r.handler;delete r.events;p._removeData(h)}}});return a},_handle:function(a,b){for(var j=p.__getListeners(a,b.type).slice(0),q,o,h=0,r=j.length;h<r;++h){q=j[h];q=q.fn.call(q.scope,b,q.data);if(q!==i)if(q===false){o=q;b.halt()}if(b.isImmediatePropagationStopped)break}return o},
fire:function(a,b,j){if(!m("fire",a,b,j)){var q;d.query(a).each(function(o){var h=!o.isCustomEventTarget;j=j||{};j.type=b;if(h){if(c(o)){h=new l(o,j);var r=h.target=o,s="on"+b;do{var y=(p._data(r)||{}).handler;h.currentTarget=r;y&&y.call(r,h);if(r[s]&&r[s].call(r)===false){q=false;h.preventDefault()}r=r.parentNode||r.ownerDocument||r===o.ownerDocument&&window}while(r&&!h.isPropagationStopped);if(!h.isDefaultPrevented)if(!(b==="click"&&o.nodeName.toLowerCase()=="a")){var w;try{if(s&&o[b]){if(w=o[s])o[s]=
null;t=b;o[b]()}}catch(A){}if(w)o[s]=w;t=u}}}else if((o=p._data(o))&&n.isFunction(o.handler))q=o.handler(i,j)});return q}},_batchForType:m,_simpleAdd:e,_simpleRemove:g};p.on=p.add;p.detach=p.remove;return p},{requires:["dom","event/object"]});
KISSY.add("event/delegate",function(n,d,l){function i(e){return e.fn===undefined&&e.selector===undefined?true:e.fn===undefined?this.selector==e.selector:this.fn==e.fn&&this.selector==e.selector&&this.scope==e.scope}function m(e,g){var v,t=d.closest(e.target,[g.selector],this);if(t)for(var u=0;u<t.length;u++){e.currentTarget=t[u];var f=g.fn.call(g.scope||this,e);if(f===false||e.isPropagationStopped||e.isImmediatePropagationStopped){if(f===false)v=f;if(e.isPropagationStopped||e.isImmediatePropagationStopped)break}}return v}
var c=l._batchForType,k={focus:"focusin",blur:"focusout"};n.mix(l,{delegate:function(e,g,v,t,u){if(c("delegate",e,g,v,t,u))return e;d.query(e).each(function(f){if(!f.isCustomEventTarget){g=k[g]||g;l.on(f,g,m,f,{fn:t,selector:v,scope:u,equals:i})}});return e},undelegate:function(e,g,v,t,u){if(c("undelegate",e,g,v,t,u))return e;d.query(e).each(function(f){if(!f.isCustomEventTarget){g=k[g]||g;l.remove(f,g,m,f,{fn:t,selector:v,scope:u,equals:i})}})}});return l},{requires:["dom","./base"]});
KISSY.add("event/focusin",function(n,d,l){d.ie||n.each([{name:"focusin",fix:"focus"},{name:"focusout",fix:"blur"}],function(i){function m(k){return l.fire(k.target,i.name)}var c=0;l.special[i.name]={setup:function(){c++===0&&document.addEventListener(i.fix,m,true)},tearDown:function(){--c===0&&document.removeEventListener(i.fix,m,true)}}});return l},{requires:["ua","./base"]});
KISSY.add("event/hashchange",function(n,d,l,i){i=document.documentMode||i.ie;if(!("onhashchange"in window)||i<8){var m,c=[],k=u();d.special.hashchange={setup:function(){-1===n.indexOf(this,c)&&c.push(this);m||e()},tearDown:function(){var f=n.indexOf(this,c);f>=0&&c.splice(f,1);if(c.length===0){m&&clearTimeout(m);m=null}}};var e=function(){g()},g=function(){var f=u();if(f!==k){v(f);k=f}m=setTimeout(g,50)},v=function(f){t(f)},t=function(){for(var f=0;f<c.length;f++)d._handle(c[f],{type:"hashchange"})},
u=function(){return"#"+location.href.replace(/^[^#]*#?(.*)$/,"$1")};i<8&&function(){var f;e=function(){if(!f){f=l.create('<iframe style="display: none" height="0" width="0" tabindex="-1" title="empty"/>');l.prepend(f,document.documentElement);d.add(f,"load",function(){d.remove(f,"load");v(u());d.add(f,"load",p);g()});var p=function(){var a=n.trim(f.contentWindow.document.body.innerHTML),b=u();if(a!=b)k=location.hash=a;t(a)}}};v=function(p){p="<html><body>"+p+"</body></html>";var a=f.contentWindow.document;
try{a.open();a.write(p);a.close();return true}catch(b){return false}}}()}},{requires:["./base","dom","ua"]});
KISSY.add("event/mouseenter",function(n,d,l,i){i.ie||n.each([{name:"mouseenter",fix:"mouseover"},{name:"mouseleave",fix:"mouseout"}],function(m){function c(k){var e=this,g=k.relatedTarget;k.type=m.name;try{if(!(g&&g!==document&&!g.parentNode)){g=l.closest(g,function(t){return t==e});g!==e&&d._handle(e,k)}}catch(v){}}d.special[m.name]={setup:function(){d.add(this,m.fix,c)},tearDown:function(){d.remove(this,m.fix,c)}}});return d},{requires:["./base","dom","ua"]});
KISSY.add("event/object",function(n,d){function l(c,k,e){this.currentTarget=c;this.originalEvent=k||{};if(k){this.type=k.type;this._fix()}else{this.type=e;this.target=c}this.currentTarget=c;this.fixed=true}var i=document,m="altKey attrChange attrName bubbles button cancelable charCode clientX clientY ctrlKey currentTarget data detail eventPhase fromElement handler keyCode layerX layerY metaKey newValue offsetX offsetY originalTarget pageX pageY prevValue relatedNode relatedTarget screenX screenY shiftKey srcElement target toElement view wheelDelta which".split(" ");
n.augment(l,{_fix:function(){var c=this.originalEvent,k=m.length,e,g=this.currentTarget;for(g=g.nodeType===9?g:g.ownerDocument||i;k;){e=m[--k];this[e]=c[e]}if(!this.target)this.target=this.srcElement||i;if(this.target.nodeType===3)this.target=this.target.parentNode;if(!this.relatedTarget&&this.fromElement)this.relatedTarget=this.fromElement===this.target?this.toElement:this.fromElement;if(this.pageX===d&&this.clientX!==d){c=g.documentElement;k=g.body;this.pageX=this.clientX+(c&&c.scrollLeft||k&&k.scrollLeft||
0)-(c&&c.clientLeft||k&&k.clientLeft||0);this.pageY=this.clientY+(c&&c.scrollTop||k&&k.scrollTop||0)-(c&&c.clientTop||k&&k.clientTop||0)}if(this.which===d)this.which=this.charCode!==d?this.charCode:this.keyCode;if(this.metaKey===d)this.metaKey=this.ctrlKey;if(!this.which&&this.button!==d)this.which=this.button&1?1:this.button&2?3:this.button&4?2:0},preventDefault:function(){var c=this.originalEvent;if(c.preventDefault)c.preventDefault();else c.returnValue=false;this.isDefaultPrevented=true},stopPropagation:function(){var c=
this.originalEvent;if(c.stopPropagation)c.stopPropagation();else c.cancelBubble=true;this.isPropagationStopped=true},stopImmediatePropagation:function(){var c=this.originalEvent;c.stopImmediatePropagation?c.stopImmediatePropagation():this.stopPropagation();this.isImmediatePropagationStopped=true},halt:function(c){c?this.stopImmediatePropagation():this.stopPropagation();this.preventDefault()}});return l});
KISSY.add("event/target",function(n,d){return{isCustomEventTarget:true,fire:function(l,i){return d.fire(this,l,i)},on:function(l,i,m){d.add(this,l,i,m);return this},detach:function(l,i,m){d.remove(this,l,i,m);return this}}},{requires:["./base","dom"]});
KISSY.add("event/valuechange",function(n,d,l){function i(a){var b=l.data(a,t);if(!b){b=+new Date;l.data(a,t,b)}return b}function m(a){a=i(a);delete u[a];if(f[a]){clearTimeout(f[a]);delete f[a]}}function c(a){m(a.target)}function k(a){var b=i(a);f[b]||(f[b]=setTimeout(function(){var j=a.value;if(j!==u[b]){d._handle(a,{type:v,prevVal:u[b],newVal:j});u[b]=j}f[b]=setTimeout(arguments.callee,p)},p))}function e(a){var b=a.target;if(a.type=="focus"){a=i(b);u[a]=b.value}k(b)}function g(a){m(a);d.remove(a,
"blur",c);d.remove(a,"mousedown keyup keydown focus",e);l.removeData(a,t)}var v="valueChange",t="event/valuechange",u={},f={},p=50;d.special[v]={fix:false,setup:function(){var a=this.nodeName.toLowerCase();if("input"==a||"textarea"==a){g(this);d.on(this,"blur",c);d.on(this,"mousedown keyup keydown focus",e)}},tearDown:function(){g(this)}};return d},{requires:["./base","dom"]});
KISSY.add("event",function(n,d,l,i){d.Target=l;d.Object=i;return d},{requires:["event/base","event/target","event/object","event/focusin","event/hashchange","event/valuechange","event/delegate","event/mouseenter"]});
